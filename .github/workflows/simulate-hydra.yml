name: Simulate SÉRAPHIN ∞ Hydra

on:
  workflow_dispatch:  # Manuel depuis GitHub (bouton "Run workflow")
    inputs:
      version:
        description: 'Version to run (core or ultimate)'
        required: true
        default: 'ultimate'
        type: choice
        options: ['core', 'ultimate']
      pulses:
        description: 'Number of simulation pulses'
        required: false
        default: '1000'
      depth:
        description: 'Maximum recursion depth'
        required: false
        default: '15'
      quantum_force:
        description: 'Force quantum-inspired mode (ultimate only)'
        required: false
        type: boolean
        default: false

jobs:
  simulate:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install numpy matplotlib qiskit

      - name: Run simulation
        run: |
          if [ "${{ inputs.version }}" == "core" ]; then
            python seraphin_core.py --simulate --pulses ${{ inputs.pulses }} --depth ${{ inputs.depth }}
          else
            python seraphin_ultimate.py --simulate --pulses ${{ inputs.pulses }} --depth ${{ inputs.depth }} ${{ inputs.quantum_force && '--quantum-force' || '' }}
          fi

      - name: Upload visualizations as artifacts
        uses: actions/upload-artifact@v4
        with:
          name: julia-visualizations
          path: visualizations/*.png
